
services:
  ngrok:
    image: ngrok/ngrok
    restart: unless-stopped
    container_name: ngrok
    ports:
      - 4040:4040
    environment:
      - NGROK_AUTHTOKEN=${NGROK_AUTHTOKEN}
      - NGROK_REGION=${NGROK_REGION}
    volumes:
      - ./policy.yml:/etc/ngrok/policy.yml
    command: http host.docker.internal:5678 --traffic-policy-file /etc/ngrok/policy.yml


  n8n:
    image: n8nio/n8n:1.119.1
    restart: unless-stopped
    container_name: n8n
    ports:
      - 5678:5678
    environment:
      - WEBHOOK_TUNNEL_URL=${WEBHOOK_TUNNEL_URL}
      - WEBHOOK_URL=${WEBHOOK_URL}
      # Corrections des avertissements de dépréciation
      - DB_SQLITE_POOL_SIZE=5
      - N8N_RUNNERS_ENABLED=true
      # Amélioration sécurité et performance
      - N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=true
      - N8N_GIT_NODE_DISABLE_BARE_REPOS=true
      # Garder l'accès aux variables d'env dans Code Node si nécessaire
      - N8N_BLOCK_ENV_ACCESS_IN_NODE=false
    volumes:
      - n8n_data:/home/node/.n8n

volumes:
  n8n_data:
    external: true




